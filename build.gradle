group 'RLBot'
version '1.0-SNAPSHOT'


buildscript {
    repositories {
        jcenter()
    }
    dependencies {
    }
}

apply plugin: 'java'

repositories {
    jcenter()
}

dependencies {
    compile 'rlbotofficial.RLBotProtoMaven:proto-interface:0.0.2:game_data@py'
    compile 'rlbotofficial.RLBotProtoMaven:proto-interface:0.0.2'
    compile group: 'net.java.dev.jna', name: 'jna', version: '4.5.1'
    compile group: 'net.java.dev.jna', name: 'jna-platform', version: '4.5.1'
    compile group: 'com.google.protobuf', name: 'protobuf-java', version: '3.1.0'
    compile group: 'net.sf.py4j', name: 'py4j', version: '0.10.6'
}

task assembleProto(type: Copy) {
    from findFile('game_data.py')
    into 'protobuf'
    rename { String file ->
        'game_data_pb2.py'
    }
}

clean {
    delete fileTree('protobuf') {
        include '**/*pb2.py'
    }
}

def findFile(suffix) {
    configurations.compile.filter { it.name.endsWith(suffix) }
}

task pipInstallRequirements(type: Exec) {
    commandLine "pip", "install", "-r", "requirements.txt"
}

task run(type: Exec) {
    commandLine "python", "runner.py"
}

run.dependsOn build
processResources.dependsOn pipInstallRequirements
processResources.dependsOn assembleProto


